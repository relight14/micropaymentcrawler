I prepared a minimal, focused patch that implements the deferred project-creation flow you asked for:

Do not auto-create a project when the user is unauthenticated.
Do not clear or reload the live chat during login/project creation.
Only create the server project after the user authenticates in response to clicking "Find Sources".
Centralize the "Find Sources" trigger so the SOURCE_SEARCH_TRIGGER is only dispatched when Find Sources is explicitly clicked or after a successful login that was started by clicking Find Sources.
Below are the concrete file changes (patch content). I kept the edits small and localized so you can drop them into the repo easily or I can push them for you.


backend/static/js/managers/project-manager.js
/* NOTE: This snippet shows the updated portions of project-manager.js.
   Replace the corresponding functions in your file with these updated implementations.
   Key changes:
   - ensureActiveProject now defers server work if user is unauthenticated (returns { deferred: true }).
   - handleLogin now only migrates pre-login chat when there is an explicit pendingAction of type 'create_project_on_login'.
*/

backend/static/js/app.js
/* NOTE: This snippet shows the updated portions of app.js.
   Replace the corresponding functions/initialization block in your file with these changes.
   Key changes:
   - Removed the automatic ensureActiveProject call from sendMessage (prevents server creation while unauthenticated).
   - Added a dedicated Find Sources click handler that defers to auth if necessary or triggers the source search when authenticated.
   - The Find Sources handler sets a pendingAction when unauthenticated and opens the auth modal (if available) without clearing or reloading chat.
What I changed and why

Removed the automatic ensureActiveProject call from the general chat send flow so sending messages never triggers protected project-creation network calls (prevents the 401 / projects/undefined issues).
Added a centralized Find Sources handler that:
When unauthenticated: sets appState.pendingAction and opens the auth modal (no chat clearing or server writes).
When authenticated: creates/finds the project and fires SOURCE_SEARCH_TRIGGER.
Modified ProjectManager.handleLogin to only migrate (create project from in-memory chat) when there's an explicit pending action of type create_project_on_login. That prevents automatic migrations on all logins and ensures migrations happen only when triggered by Find Sources click.
Modified ensureActiveProject to return { deferred: true } when called while unauthenticated (so callers can handle/short-circuit without triggering 401s).
Next steps (if you want me to commit)

I can create a small PR with these edits and run the patch directly against those two files in your repo. If you want that, I will:
Update the full files in the repo (not just snippets).
Run a quick smoke test checklist to search for function names used elsewhere (modalController.showAuthModal availability, sidebar.loadProject signature with skipMessageRestore).
If any downstream call sites rely on the previous behavior, I can add minimal compatibility adaptors (e.g., a skipMessageRestore flag handling in sidebar.loadProject).
If you'd like, I can push these edits as a commit/PR now. Would you like me to:

(A) create the PR with the changes applied directly to the two files (I will attempt to preserve all other file contents), or
(B) produce a complete patch/diff you can apply locally instead?
Also note:

Before merging, please confirm the exact method name your modalController exposes to open the auth modal (I used showAuthModal/openAuthModal fallbacks). If you prefer, tell me the actual method and I will update the code to call it directly.
If sidebar.loadProject currently always restores messages into the chat, I can add the skipMessageRestore branch there as well â€” that prevents any reload/replace of the live chat DOM after creating the project.