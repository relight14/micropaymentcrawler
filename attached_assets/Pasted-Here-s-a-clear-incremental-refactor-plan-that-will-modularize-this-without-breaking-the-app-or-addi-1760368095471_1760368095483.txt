Hereâ€™s a clear, incremental refactor plan that will modularize this without breaking the app or adding unnecessary complexity.

ğŸ§± 1. Separate by Concern

You can divide this file into 4 logical layers, each with its own module directory:

/src
 â”œâ”€â”€ app/
 â”‚    â”œâ”€â”€ app-controller.js       â† the lightweight orchestrator (replaces app.js)
 â”‚    â”œâ”€â”€ event-router.js         â† sets up all DOM/event listeners
 â”‚    â”œâ”€â”€ toast-manager.js        â† handles toast rendering + lifecycle
 â”‚    â””â”€â”€ modal-controller.js     â† handles auth + funding modals
 â”œâ”€â”€ services/
 â”‚    â”œâ”€â”€ api.js
 â”‚    â”œâ”€â”€ auth.js
 â”‚    â””â”€â”€ wallet.js               â† optional: isolate funding/wallet logic
 â”œâ”€â”€ components/
 â”‚    â”œâ”€â”€ ui-manager.js
 â”‚    â”œâ”€â”€ message-renderer.js
 â”‚    â”œâ”€â”€ source-card.js
 â”‚    â””â”€â”€ report-builder.js
 â””â”€â”€ state/
      â””â”€â”€ app-state.js

âš™ï¸ 2. Extract â€œHeavyâ€ Responsibilities First
ğŸ§© A. toast-manager.js

Everything from initializeToastSystem, showToast, and dismissToast should move to its own class:

export class ToastManager {
  constructor(containerSelector = '#toastContainer') { ... }
  show(message, type = 'info', duration = 3000) { ... }
  dismiss(id) { ... }
}


Then ChatResearchApp just does:

this.toastManager = new ToastManager();
this.toastManager.show('Session expired', 'info');

ğŸ§© B. event-router.js

Move all event listener wiring out of initializeEventListeners():

export class EventRouter {
  constructor(app, uiManager, authService, appState) {
    this.app = app;
    this.ui = uiManager;
    this.auth = authService;
    this.state = appState;
  }
  registerAll() {
    this.registerChatEvents();
    this.registerAuthEvents();
    this.registerModeSwitching();
    ...
  }
}


Then in app-controller.js:

this.eventRouter = new EventRouter(this, this.uiManager, this.authService, this.appState);
this.eventRouter.registerAll();


This drastically lightens the controller and isolates DOM bindings.

ğŸ§© C. modal-controller.js

Extract auth modal and funding modal rendering into a new class:

export class ModalController {
  constructor(authService, uiManager) { ... }
  showAuthModal() { ... }
  showFundingModal() { ... }
}


That lets your main app reduce hundreds of lines to:

this.modals = new ModalController(this.authService, this.uiManager);
...
this.modals.showAuthModal();

ğŸ§© D. report-builder.js

Extract all report-builder-related DOM creation (_generateReportBuilderDOM, _createTierCard, _attachTierPurchaseListeners) into its own component file:

export class ReportBuilder {
  constructor(appState, uiManager) { ... }
  render() { ... }
}


Then ChatResearchApp.displayReportBuilderResults() simply becomes:

const reportBuilder = new ReportBuilder(this.appState, this.uiManager);
this.addMessage('system', reportBuilder.render());

ğŸ§© 3. Keep ChatResearchApp as a Lightweight Orchestrator

After the refactor, your ChatResearchApp (renamed to AppController) should mainly do:

Dependency injection (authService, apiService, uiManager, etc.)

Initialize modular subsystems

Wire global event handlers (e.g., SourceCardReady, sourceUnlockRequested)

Manage global app state transitions

Roughly 200â€“250 lines total, down from 2,000+.

ğŸ§  4. Optional Enhancements

Lazy-load noncritical modules (e.g., import() modals or report builder only when needed).

Event-driven pattern: have subsystems emit and listen to CustomEvents (app:auth:success, ui:mode:changed), reducing tight coupling.

Dependency container: add a simple registry to manage singletons (serviceLocator.get('auth')).

âœ… Example High-Level Refactor Flow
import { APIService } from '../services/api.js';
import { AuthService } from '../services/auth.js';
import { UIManager } from '../components/ui-manager.js';
import { EventRouter } from './event-router.js';
import { ToastManager } from './toast-manager.js';
import { ModalController } from './modal-controller.js';

export class AppController {
  constructor() {
    this.auth = new AuthService();
    this.api = new APIService(this.auth);
    this.ui = new UIManager();
    this.toast = new ToastManager();
    this.modals = new ModalController(this.auth, this.ui);
    this.events = new EventRouter(this, this.ui, this.auth);
  }

  async init() {
    await this.auth.validateToken();
    this.ui.init();
    this.events.registerAll();
    this.toast.show('App ready', 'success');
  }
}
